
- name: Check connection to Hashicorp Vault
  hosts: localhost
  gather_facts: no
  environment:
    VAULT_ADDR: "http://127.0.0.1:8200"

  vars:
    # –ü–æ–ª—É—á–∞–µ–º –í–ï–°–¨ —Å–µ–∫—Ä–µ—Ç –∏–∑ Vault
    aws_secrets: >-
      {{
        lookup('hashi_vault',
          'secret=secret/data/ansible/aws ' +
          'token=' + lookup('env', 'VAULT_TOKEN') + ' ' +
          'url=' + lookup('env', 'VAULT_ADDR') + ' ' +
          'engine_version=2'
        )
      }}

    aws_region: "{{ aws_secrets.AWS_REGION }}"
    ecr_account: "{{ aws_secrets.ECR.ACCOUNT }}"

  tasks:
     - name: üóÇ –†–∞–∑–ª–æ–∂–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ –∞–ª–∏–∞—Å—ã
       set_fact:
         aws_region: "{{ aws_secrets.AWS_REGION }}"
         ecr_account: "{{ aws_secrets.ECR_ACCOUNT }}"

     - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
       debug:

         msg: "Region={{ aws_region }}, Account={{ ecr_account }}"
     - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ EC2 –≤–∏–¥–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
       command: printenv
       environment:
         AWS_REGION: "{{ aws_region }}"
         ECR_ACCOUNT: "{{ ecr_account }}"

